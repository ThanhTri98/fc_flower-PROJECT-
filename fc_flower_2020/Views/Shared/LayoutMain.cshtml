@using fc_flower_2020.Models
@using MyDataBase
<!doctype html>
<html class="no-js" lang="en">

<head>
    <!-- Basic page needs
        ============================================ -->
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <meta name="description" content="">
    <!-- Mobile specific metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="~/Assets/img/favicon.ico">
    <!-- font awesome -->
    <link rel="stylesheet" href="~/Assets/css/font-awesome.min.css">
    <!-- carousel CSS -->
    <link rel="stylesheet" href="~/Assets/css/owl.carousel.css">
    <!-- carousel Theme CSS -->
    <link rel="stylesheet" href="~/Assets/css/owl.my_theme.css">
    <!-- carousel transitions CSS -->
    <link rel="stylesheet" href="~/Assets/css/owl.transitions.css">
    <!-- nivo slider slider css -->
    <link rel="stylesheet" href="~/Assets/css/nivo-slider.css">
    <!-- animate css -->
    <link rel="stylesheet" href="~/Assets/css/animate.css">
    <!-- Price jquery-ui  -->
    <link rel="stylesheet" href="~/Assets/css/jquery-ui.css">
    <!-- fancy-box theme -->
    <link rel="stylesheet" href="~/Assets/fancy-box/jquery.fancybox.css">
    <!-- normalizer -->
    <link rel="stylesheet" href="~/Assets/css/normalize.css">
    <!-- bootstrap -->
    <link rel="stylesheet" href="~/Assets/css/bootstrap.min.css">
    <!-- Mobile menu css -->
    <link rel="stylesheet" href="~/Assets/css/meanmenu.min.css">
    <!-- main -->
    <link rel="stylesheet" href="~/Assets/css/main.css">
    <!-- style -->
    <link rel="stylesheet" href="~/Assets/css/style.css">
    <!-- Responsive css -->
    <link rel="stylesheet" href="~/Assets/css/custom.css">
    <!-- Responsive css -->
    <link rel="stylesheet" href="~/Assets/css/responsive.css">
    <!-- modernizr JS -->
    <script src="~/Assets/js/vendor/modernizr-2.8.3.min.js"></script>
</head>

<body>
    <div class="header_area_top">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <!--Start Search area -->
                    <form action="#" name="myForm">
                        <div class="search_box">
                            <input name="Name" id="itp" class="input_text" type="text" placeholder="Tìm kiếm">
                            <button type="submit" class="btn-search">
                                <span><i class="fa fa-search"></i></span>
                            </button>
                        </div>
                    </form>
                    <!--End Search area -->
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <!--Start Logo area -->
                    <div class="logo">
                        <a href="">
                            <img src="~/Assets/img/logo/logo3.png" alt="" />
                        </a>
                    </div>
                    <!--End Logo area -->
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <!--Start Header Right Cart area -->
                    <div class="account_card_area">
                        <ul id="account_nav">
                            <li>
                                @{ TaiKhoan taiKhoan = Session["TAIKHOAN"] as TaiKhoan;
                                    string ho_ten = taiKhoan == null ? "Tài khoản" : "xin chào " + taiKhoan.ho_ten;}
                                <a id="account"><i class="fa fa-key"></i>@ho_ten</a>
                                <div class="account_menu_list">
                                    <div class="account_single_item">
                                        <ul id="account_single_nav_3">
                                            @if (taiKhoan == null)
                                            {
                                                <li><a href="/tai-khoan">Đăng nhập/ Đăng ký</a></li>
                                            }
                                            else
                                            {
                                                <li><a href="/trang-ca-nhan">Thông tin cá nhân</a></li>
                                                <li><a href="/Account/Logout">Đăng xuất</a></li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li>
                                @{ fc_flower_2020.Models.Cart cart = Session["CartSession"] as fc_flower_2020.Models.Cart;}
                                <a href="/gio-hang">
                                    <i class="fa fa-shopping-cart"></i>Giỏ hàng <span id="cart_zero" class="cart_zero">@(cart!=null?cart.TotalItem()+"":"0")</span>
                                </a>
                                <div class="cart_down_area">

                                    @if (cart != null)
                                    {
                                        foreach (CartItem items in cart.items)
                                        {
                                            <div class="cart_single">
                                                @if (items.ma_loai_hang == 1)
                                                {
                                                    <a href="/chi-tiet-san-pham/@((items.san_pham as Hoa).ma_hoa)"><img src="~/@((items.san_pham as Hoa).hinh_anh)" alt="" /></a>
                                                }
                                                else
                                                {
                                                    <a href="/qua-tang-kem/@((items.san_pham as QuaTangKem).ma_loai)"><img src="~/@((items.san_pham as QuaTangKem).hinh_anh)" alt="" /></a>
                                                }

                                                <div>
                                                    @if (items.ma_loai_hang == 1)
                                                    {
                                                        <h2><a>@((items.san_pham as Hoa).tieu_de)</a></h2>
                                                    }
                                                    else
                                                    {
                                                        <h2><a>@((items.san_pham as QuaTangKem).ten_qua)</a></h2>
                                                    }

                                                    <div class="price_cart_contain">
                                                        <p class="amount_cart">@items.so_luong</p>
                                                        <p class="nhan">x</p>
                                                        @if (items.ma_loai_hang == 1)
                                                        {
                                                            <p class="price_cart">@(fc_flower_2020.Models.Utils.toCurrency((int)(items.san_pham as Hoa).gia_moi))</p>
                                                        }
                                                        else
                                                        {
                                                            <p class="price_cart">@(fc_flower_2020.Models.Utils.toCurrency((int)(items.san_pham as QuaTangKem).gia))</p>
                                                        }

                                                    </div>
                                                </div>
                                            </div>
                                        }

                                        <div class="cart_shoptings">
                                            <a href="/gio-hang">THANH TOÁN</a>
                                        </div>
                                    }
                                </div>
                            </li>
                        </ul>
                    </div>
                    <!--End Header Right Cart area -->
                </div>
            </div>
        </div>
    </div>
    <!--End Header Top area -->
    <!--Start Main Menu area -->
    <div class="header_botttom_area">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <!--Start desktop menu area -->
                    <div class="main_menu">
                        <ul id="nav_menu" class="active_cl">
                            <li>
                                <a href="/trang-chu"><span class="Home">Trang Chủ</span></a>

                            </li>
                            <li>
                                <a href="/san-pham/chu-de/hoa-cuoi"><span class="Clothings">Chủ Đề</span></a>
                                <div class="home_mega_menu">
                                    @{ LayoutMainModel layoutMain = new LayoutMainModel();
                                        List<ChuDe> danhSachChuDe = layoutMain.getDanhSachChuDe();}
                                    @foreach (ChuDe chuDe in danhSachChuDe)
                                    {
                                        <a href="/san-pham/chu-de/@chuDe.ma_chu_de">@chuDe.ten_chu_de</a>
                                    }
                                </div>
                            </li>
                            <li>
                                <a href="/san-pham/mau-sac/mau-hong"><span class="Footwear">Màu Sắc</span></a>
                                <div class="home_mega_menu">
                                    @{ List<MauSac> danhSachMauSac = layoutMain.getDanhSachMauSac();}
                                    @foreach (MauSac mauSac in danhSachMauSac)
                                    {
                                        <a href="/san-pham/mau-sac/@mauSac.ma_mau_sac">@mauSac.ten_mau_sac</a>
                                    }
                                </div>
                            </li>
                            <li>
                                <a href="/qua-tang-kem"><span class="Footwear">Quà Tặng Kèm</span></a>
                                <div class="home_mega_menu">
                                    @{ List<LoaiQuaTang> danhSachLoaiQua = layoutMain.getDanhSachLoaiQua();}
                                    @foreach (LoaiQuaTang loaiQua in danhSachLoaiQua)
                                    {
                                        <a href="/qua-tang-kem/@loaiQua.ma_loai">@loaiQua.ten_loai</a>
                                    }
                                </div>
                            </li>
                            <li>
                                <a href="/y-nghia-hoa"><span class="Sales">Ý Nghĩa Hoa</span></a>
                            </li>
                            <li><a href="/gioi-thieu"><span class="Accessaries">Giới Thiệu</span></a>
                        </ul>
                    </div>
                </div>
                <!--End desktop menu area -->
            </div>
        </div>
    </div>
    <!--End Main Menu area -->
    @RenderBody()
    <!--Start Branding area -->
    <div class="branding_area">
        <div class="container">
            <div class="row">
                <div class="carousel_branding">
                    <div class="col-lg-2">
                        <div class="single_branding">
                            <a href="#"><img src="~/Assets/img/branding-image/brand1.jpg" alt="" /></a>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <div class="single_branding">
                            <a href="#"><img src="~/Assets/img/branding-image/brand2.jpg" alt="" /></a>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <div class="single_branding">
                            <a href="#"><img src="~/Assets/img/branding-image/brand3.jpg" alt="" /></a>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <div class="single_branding">
                            <a href="#"><img src="~/Assets/img/branding-image/brand4.jpg" alt="" /></a>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <div class="single_branding">
                            <a href="#"><img src="~/Assets/img/branding-image/brand1.jpg" alt="" /></a>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <div class="single_branding">
                            <a href="#"><img src="~/Assets/img/branding-image/brand2.jpg" alt="" /></a>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <div class="single_branding">
                            <a href="#"><img src="~/Assets/img/branding-image/brand3.jpg" alt="" /></a>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <div class="single_branding">
                            <a href=""><img src="~/Assets/img/branding-image/brand4.jpg" alt="" /></a>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <div class="single_branding">
                            <a href="#"><img src="~/Assets/img/branding-image/brand1.jpg" alt="" /></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--End Branding area -->
    <!--Start Footer area -->
    <div class="footer_area home1_margin_top">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="feature_text feature_newsletter">
                        <h4>Newsletter</h4>
                        <p>Đăng kí ngay để nhận được các thông tin khuyến mãi và ưu đãi đặc biệt từ: fcflower.com</p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="sign_up">
                        <form action="#">
                            <input class="sign_text" type="text" placeholder="Nhập email của bạn..." />
                            <button type="submit" class="sign">
                                <span>Đăng ký</span>
                                <img src="~/Assets/img/arrow/bkg_newsletter-1.png" alt="" />
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="footer_menu_area">
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                        <div class="help_support">
                            <h2>FCFLOWER.COM</h2>
                            <ul class="footer_menu">
                                <li><a href="#">Giới thiệu</a></li>
                                <li><a href="#">Tin tức</a></li>
                                <li><a href="#">Tuyển dụng</a></li>
                                <li><a href="#">Blog</a></li>
                                <li><a href="#">Liên hệ</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                        <div class="help_support help_border">
                            <h2>CHĂM SÓC KHÁCH HÀNG</h2>
                            <ul class="footer_menu">
                                <li><a href="#">Thắc mắc và khiếu nại</a></li>
                                <li><a href="#">Cam kết hài lòng 100%</a></li>
                                <li><a href="#">Chính sách bảo mật</a></li>
                                <li><a href="#">Hướng dẫn đặt hàng</a></li>
                                <li><a href="#">Chính sách thanh toán</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                        <div class="help_support help_border">
                            <h2>SHOP HOA CÁC TỈNH</h2>
                            <ul class="footer_menu">
                                <li><a href="#">Cần Thơ: 266 P. Xuân khánh, Q.Ninh Kiều</a></li>
                                <li><a href="#">Đà Nẵng: 304 Đống Đa, Q.Hải Châu</a></li>
                                <li><a href="#">Huế: 23 Bến Nghé</a></li>
                                <li><a href="#">Lâm Đồng: 05 Phan Đình Phùng</a></li>
                                <li><a href="#">Biên Hoà: 156A Nguyễn Văn Hoa</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                        <div class="help_support help_border">
                            <h2>VĂN PHÒNG ĐIỀH HÀNH</h2>
                            <p>Công ty: <span>FC FLOWER số 1 VIỆT NAM</span></p>
                            <p>Liên hệ: <span>(+1 223) 334 3434</span></p>
                            <p>Email: <span>fcflower@gmail.com</span></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="footer_bottom_area">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="copy_visa">
                            <div class="copy_right">
                                <h2>Copyright © 2020 <a href="#">Nevir</a>. All Rights Reserved.</h2>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--End Footer area -->
    <!-- jquery JS -->
    <script src="~/Assets/js/vendor/jquery-1.11.3.min.js"></script>
    <!-- bootstrap JS -->
    <script src="~/Assets/js/bootstrap.min.js"></script>
    <!-- Mobile menu JS -->
    <script src="~/Assets/js/jquery.meanmenu.js"></script>
    <!-- jquery.easing js -->
    <script src="~/Assets/js/jquery.easing.1.3.min.js"></script>
    <!-- knob circle js -->
    <script src="~/Assets/js/jquery.knob.js"></script>
    <!-- fancybox JS -->
    <script src="~/Assets/fancy-box/jquery.fancybox.pack.js"></script>
    <!-- price slider JS  -->
    <script src="~/Assets/js/price-slider.js"></script>
    <!-- nivo slider JS -->
    <script src="~/Assets/js/jquery.nivo.slider.pack.js"></script>
    <!-- wow JS -->
    <script src="~/Assets/js/wow.js"></script>
    <!-- nivo-plugin JS -->
    <script src="~/Assets/js/nivo-plugin.js"></script>
    <!-- scrollUp JS -->
    <script src="~/Assets/js/jquery.scrollUp.js"></script>
    <!-- carousel JS -->
    <script src="~/Assets/js/owl.carousel.min.js"></script>
    <!-- plugins JS -->
    <script src="~/Assets/js/plugins.js"></script>
    <!-- main JS  -->
    <script src="~/Assets/js/main.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            // Thêm mới 1 item
            $('.add-cart-flower').on('click', function () {
                let ma_hang = $(this).parent().children('.msp-ajax').val();
                var formData = new FormData();
                formData.append('loai-hang', '1');
                formData.append('ma-hang', ma_hang);
                formData.append('so-luong', '1');
                sendData(formData);

            });
            $('.add-cart-gift').on('click', function () {
                let ma_hang = $(this).parent().children('.msp-ajax').val();
                var formData = new FormData();
                formData.append('loai-hang', '2');
                formData.append('ma-hang', ma_hang);
                formData.append('so-luong', '1');
                sendData(formData);
                
            });
            // Cập nhật số lượng item
            $('.update-item').on('change', function () {
                var so_luong = $(this).val();
                var ma_hang = $(this).parent().children('.msp-ajax').val();
                var loai_hang = $(this).parent().children('.loai-hang').val();
                var formData = new FormData();
                formData.append('loai-hang', loai_hang);
                formData.append('ma-hang', ma_hang);
                formData.append('so-luong', so_luong);
                formData.append('isUpdate', '1');
                sendData(formData,ma_hang,loai_hang);
            });
        });
        function sendData(formData,ma_hang,ma_loai_hang) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/Cart/CartProcess', true);
            xhr.onreadystatechange = function () {
                // 1 request gửi đi thì server xử lý qua 4 bước
                // -- 1: Gửi Request
                // -- 2: Server nhận request
                // -- 3: Server xử lý
                // -- 4: Server trả về kết quả
                if (xhr.readyState == 4 && xhr.status == 200) { // Chỉ bắt sự kiện tại giai đoạn 4 và kết quả trả về có status là 200
                    var content = xhr.responseText;
                    var json_data = JSON.parse(content);
                    if (json_data.Data.status == 'OK') {
                        // Cap nhat lai UI
                        $('#cart_zero').html('').html(json_data.Data.totalItem);
                        $('#totalPrice').html('').html(json_data.Data.totalPrice)
                        if (ma_hang !== undefined) {
                            let id = ma_loai_hang + '-' + ma_hang;
                            $('#' + id).html('').html(json_data.Data.totalPriceOfItem);

                        }
                    }
                }
            };
            xhr.send(formData);
        }
    </script>
</body>

</html>
